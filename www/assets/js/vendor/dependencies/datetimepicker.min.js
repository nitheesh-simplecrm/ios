angular.module("ui.bootstrap.datetimepicker",[]).constant("dateTimePickerConfig",{dropdownSelector:null,minuteStep:5,minView:"minute",startView:"day",weekStart:0}).directive("datetimepicker",["dateTimePickerConfig",function(a){var b=function(f){var d=["startView","minView","minuteStep","dropdownSelector","weekStart"];for(var e in f){if(f.hasOwnProperty(e)){if(d.indexOf(e)<0){throw ("invalid option: "+e)}}}var c=["minute","hour","day","month","year"];if(c.indexOf(f.startView)<0){throw ("invalid startView value: "+f.startView)}if(c.indexOf(f.minView)<0){throw ("invalid minView value: "+f.minView)}if(c.indexOf(f.minView)>c.indexOf(f.startView)){throw ("startView must be greater than minView")}if(!angular.isNumber(f.minuteStep)){throw ("minuteStep must be numeric")}if(f.minuteStep<=0||f.minuteStep>=60){throw ("minuteStep must be greater than zero and less than 60")}if(f.dropdownSelector!==null&&!angular.isString(f.dropdownSelector)){throw ("dropdownSelector must be a string")}if(!angular.isNumber(f.weekStart)){throw ("weekStart must be numeric")}if(f.weekStart<0||f.weekStart>6){throw ("weekStart must be greater than or equal to zero and less than 7")}};return{restrict:"E",require:"ngModel",template:"<div class='datetimepicker'><table class='table-condensed'>   <thead>       <tr>           <th class='left'               data-ng-click='changeView(data.currentView, data.leftDate, $event)'               ><i class='glyphicon glyphicon-arrow-left'/></th>           <th class='switch' colspan='5'               data-ng-click='changeView(data.previousView, data.currentDate, $event)'>{{ data.title }}</th>           <th class='right'               data-ng-click='changeView(data.currentView, data.rightDate, $event)'             ><i class='glyphicon glyphicon-arrow-right'/></th>       </tr>       <tr>           <th class='dow' data-ng-repeat='day in data.dayNames' >{{ day }}</th>       </tr>   </thead>   <tbody>       <tr data-ng-class='{ hide: data.currentView == \"day\" }' >           <td colspan='7' >              <span    class='{{ data.currentView }}'                        data-ng-repeat='dateValue in data.dates'                         data-ng-class='{active: dateValue.active, past: dateValue.past, future: dateValue.future}'                        data-ng-click=\"changeView(data.nextView, dateValue.date, $event)\">{{ dateValue.display }}</span>            </td>       </tr>       <tr data-ng-show='data.currentView == \"day\"' data-ng-repeat='week in data.weeks'>           <td data-ng-repeat='dateValue in week.dates'                data-ng-click='changeView(data.nextView, dateValue.date, $event)'               class='day'                data-ng-class='{active: dateValue.active, past: dateValue.past, future: dateValue.future}' >{{ dateValue.display }}</td>       </tr>   </tbody></table></div>",scope:{ngModel:"=",onSetTime:"="},replace:true,link:function(f,e,c){var d={};if(c.datetimepickerConfig){d=f.$eval(c.datetimepickerConfig)}var i={};angular.extend(i,a,d);b(i);var h={year:function(p){var n=moment.utc(p).startOf("year");var q=(parseInt(n.year()/10,10)*10);var k=moment.utc(n).year(q-1).startOf("year");var j=f.ngModel?moment(f.ngModel).year():0;var r={currentView:"year",nextView:i.minView==="year"?"setTime":"month",title:q+"-"+(q+9),leftDate:moment.utc(k).subtract(9,"year").valueOf(),rightDate:moment.utc(k).add(11,"year").valueOf(),dates:[]};for(var m=0;m<12;m++){var o=moment.utc(k).add(m,"years");var l={date:o.valueOf(),display:o.format("YYYY"),past:o.year()<q,future:o.year()>q+9,active:o.year()===j};r.dates.push(l)}return r},month:function(l){var k=moment.utc(l).startOf("year");var o=f.ngModel?moment(f.ngModel).format("YYYY-MMM"):0;var j={previousView:"year",currentView:"month",nextView:i.minView==="month"?"setTime":"day",currentDate:k.valueOf(),title:k.format("YYYY"),leftDate:moment.utc(k).subtract(1,"year").valueOf(),rightDate:moment.utc(k).add(1,"year").valueOf(),dates:[]};for(var n=0;n<12;n++){var p=moment.utc(k).add(n,"months");var m={date:p.valueOf(),display:p.format("MMM"),active:p.format("YYYY-MMM")===o};j.dates.push(m)}return j},day:function(v){var r=moment.utc(v);var o=moment.utc(r).startOf("month");var s=moment.utc(r).endOf("month");var l=moment.utc(o).subtract(Math.abs(o.weekday()-i.weekStart),"days");var t=f.ngModel?moment(f.ngModel).format("YYYY-MMM-DD"):"";var w={previousView:"month",currentView:"day",nextView:i.minView==="day"?"setTime":"hour",currentDate:r.valueOf(),title:r.format("YYYY-MMM"),leftDate:moment.utc(o).subtract(1,"months").valueOf(),rightDate:moment.utc(o).add(1,"months").valueOf(),dayNames:[],weeks:[]};for(var u=i.weekStart;u<i.weekStart+7;u++){w.dayNames.push(moment.utc().weekday(u).format("dd"))}for(var p=0;p<6;p++){var k={dates:[]};for(var n=0;n<7;n++){var q=moment.utc(l).add((p*7)+n,"days");var m={date:q.valueOf(),display:q.format("D"),active:q.format("YYYY-MMM-DD")===t,past:q.isBefore(o),future:q.isAfter(s)};k.dates.push(m)}w.weeks.push(k)}return w},hour:function(k){var n=moment.utc(k).hour(0).minute(0).second(0);
var p=f.ngModel?moment(f.ngModel).format("YYYY-MM-DD H"):"";var j={previousView:"day",currentView:"hour",nextView:i.minView==="hour"?"setTime":"minute",currentDate:n.valueOf(),title:n.format("YYYY-MMM-DD"),leftDate:moment.utc(n).subtract(1,"days").valueOf(),rightDate:moment.utc(n).add(1,"days").valueOf(),dates:[]};for(var m=0;m<24;m++){var o=moment.utc(n).add(m,"hours");var l={date:o.valueOf(),display:o.format("H:00"),active:o.format("YYYY-MM-DD H")===p};j.dates.push(l)}return j},minute:function(l){var o=moment.utc(l).minute(0).second(0);var q=f.ngModel?moment(f.ngModel).format("YYYY-MM-DD H:mm"):"";var j={previousView:"hour",currentView:"minute",nextView:"setTime",currentDate:o.valueOf(),title:o.format("YYYY-MMM-DD H:mm"),leftDate:moment.utc(o).subtract(1,"hours").valueOf(),rightDate:moment.utc(o).add(1,"hours").valueOf(),dates:[]};var k=60/i.minuteStep;for(var n=0;n<k;n++){var p=moment.utc(o).add(n*i.minuteStep,"minute");var m={date:p.valueOf(),display:p.format("H:mm"),active:p.format("YYYY-MM-DD H:mm")===q};j.dates.push(m)}return j},setTime:function(k){var l=new Date(k);var j=new Date(l.getTime()+(l.getTimezoneOffset()*60000));if(i.dropdownSelector){jQuery(i.dropdownSelector).dropdown("toggle")}if(angular.isFunction(f.onSetTime)){f.onSetTime(j,f.ngModel)}f.ngModel=j;return h[f.data.currentView](k)}};var g=function(){var j=(f.ngModel?moment(f.ngModel).toDate():new Date());return j.getTime()-(j.getTimezoneOffset()*60000)};f.changeView=function(l,j,k){if(k){k.stopPropagation();k.preventDefault()}if(l&&(j>-Infinity)&&h[l]){f.data=h[l](j)}};f.changeView(i.startView,g());f.$watch("ngModel",function(){f.changeView(f.data.currentView,g())})}}}]);